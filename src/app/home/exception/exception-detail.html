<div class="container" id="exception_module">
    <div class="mini-charts">
        <div class="row">
            <div class="col-sm-6 col-md-3">
                <div class="mini-charts-item bgm-cyan">
                    <div class="clearfix">
                        <div class="chart" data-sparkline-bar="[6,4,8,6,5,6,7,8,3,5,9,5,8,4,3,6,8]"></div>
                        <div class="count">
                            <small>异常总数</small>
                            <h2>{{exceptionDetailCtrl.stats.totalNum | myNumber : 0}}</h2>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-sm-6 col-md-3">
                <div class="mini-charts-item bgm-red">
                    <div class="clearfix">
                        <div class="chart" data-sparkline-line="[5,6,3,9,7,5,4,6,5,6,4,9]"></div>
                        <div class="count">
                            <small>报警</small>
                            <h2>{{exceptionDetailCtrl.stats.warningNum | myNumber : 0}}</h2>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-sm-6 col-md-3">
                <div class="mini-charts-item bgm-orange">
                    <div class="clearfix">
                        <div class="chart" data-sparkline-line="[9,4,6,5,6,4,5,7,9,3,6,5]"></div>
                        <div class="count">
                            <small>故障</small>
                            <h2>{{exceptionDetailCtrl.stats.failNum | myNumber : 0}}</h2>
                        </div>
                    </div>
                </div>
            </div>


            <div class="col-sm-6 col-md-3">
                <div class="mini-charts-item bgm-brown">
                    <div class="clearfix">
                        <div class="chart" data-sparkline-line="[5,6,3,9,7,5,4,6,5,6,4,9]"></div>
                        <div class="count">
                            <small>未知</small>
                            <h2>{{exceptionDetailCtrl.stats.unknownNum | myNumber : 0}}</h2>
                        </div>
                    </div>
                </div>
            </div>

        </div>
        <div class="card">
            <div class="card-header">
                <div class="row">
                    <div class="col-sm-10">
                        <h2>异常设备【{{exceptionDetailCtrl.exception.owner}}】<small>设备所属用户：{{exceptionDetailCtrl.exception.adminNames.join(',')}}</small></h2>
                    </div>
                    <div class="col-sm-2 btn-demo">
                        <button data-ui-sref="home.exception({page: exceptionDetailCtrl.page, count: exceptionDetailCtrl.count})"
                                class="btn btn-info btn-icon pull-right"><i class="zmdi zmdi-arrow-back"></i></button>
                    </div>
                </div>

                <div class="row">
                    <div class="col-sm-4 col-md-4 cat-toolbar">
                        <button class="btn btn-default btn-icon-text" ng-if="homeCtrl.isAdmin" data-ng-click="exceptionDetailCtrl.checkAll()">
                            <i class="zmdi" data-ng-class="{ 'zmdi-close': exceptionDetailCtrl.allChecked, 'zmdi-check-all': !exceptionDetailCtrl.allChecked }"></i>
                            {{exceptionDetailCtrl.allChecked ? '取消全选' : '全选'}}
                        </button>
                        <button class="btn btn-danger btn-icon-text" ng-if="homeCtrl.isAdmin" data-ng-click="exceptionDetailCtrl.delBatch()"><i class="zmdi zmdi-delete"></i> 批量删除</button>
                        <button class="btn bgm-teal btn-icon-text" ng-if="homeCtrl.isAdmin" data-ng-click="exceptionDetailCtrl.handleBatch()"><i class="zmdi zmdi-check"></i> 标记已处理</button>
                    </div>
                    <div class="col-sm-2 col-md-2">
                        <div class="date-picker input-group" ng-class="{ 'is-opened': opened == true }">
                            <span class="input-group-addon"><i class="zmdi zmdi-calendar ma-icon"></i></span>
                            <div class="fg-line" ng-class="{ 'fg-toggled': opened == true }">
                                <input ng-click="open($event, 'opened')" type="text" class="form-control" uib-datepicker-popup="{{format}}"
                                       show-weeks="false" ng-model="dtPopup" is-open="opened" min-date="minDate" datepicker-options="dateOptions"
                                       ng-required="true" current-text="今天" close-text="关闭" placeholder="查询开始时间" />
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-2 col-md-2">
                        <div class="date-picker input-group dp-blue" ng-class="{ 'is-opened': opened2 == true }">
                            <span class="input-group-addon"><i class="zmdi zmdi-calendar ma-icon"></i></span>
                            <div class="fg-line" ng-class="{ 'fg-toggled': opened2 == true }">
                                <input ng-click="open($event, 'opened2')" type="text" class="form-control" uib-datepicker-popup="{{format}}"
                                       show-weeks="false" ng-model="dtPopup2" is-open="opened2" min-date="minDate" datepicker-options="dateOptions"
                                       ng-required="true" current-text="今天" close-text="关闭" placeholder="查询结束时间" />
                            </div>
                        </div>
                    </div>
                    <div class="chat-search col-sm-4 col-md-4">
                        <div class="fg-line">
                            <input type="text" class="form-control"
                                   placeholder="支持按异常内容、分析结果进行模糊查询"
                                   data-ng-model="exceptionDetailCtrl.keyword">
                        </div>
                    </div>
                </div>
            </div>

            <div class="card-body">
                <div class="table-responsive">
                    <table ng-table="exceptionDetailCtrl.tableData" class="table table-striped table-vmiddle">
                        <tr ng-repeat="row in $data">
                            <td data-title="''">
                                <div class="checkbox m-b-15">
                                    <label>
                                        <input type="checkbox" data-ng-model="row.checked">
                                        <i class="input-helper"></i>
                                    </label>
                                </div>
                            </td>
                            <td data-title="'NO.'" data-sortable="'id'">
                                {{ row.id }}
                            </td>
                            <td data-title="'设备id'" data-sortable="'eqId'">
                                {{ row.eqId }}
                            </td>
                            <td data-title="'异常内容'" data-sortable="'content'">
                                {{ row.content }}
                            </td>
                            <td data-title="'时间'" data-sortable="'time'">
                                {{ row.time }}
                            </td>
                            <td data-title="'异常类型'" data-sortable="'exceptionType'">
                                <div data-ng-if="row.exceptionType == 'WARNING'">警告</div>
                                <div data-ng-if="row.exceptionType == 'FAIL'">故障</div>
                                <div data-ng-if="row.exceptionType == 'UNKNOWN'">未知</div>
                            </td>
                            <td data-title="'分析结果'" data-sortable="'analyzeResult'">
                                {{ row.analyzeResult }}
                            </td>
                            <td data-title="'已经处理'" data-sortable="'handled'">
                                {{ row.handled ? '是' : '否' }}
                            </td>
                            <td data-title="'处理'" ng-if="homeCtrl.isAdmin">
                                <!--标记处理-->
                                <button type="button" class="btn bgm-teal" data-ng-click="exceptionDetailCtrl.handle(row)">
                                    <i class="zmdi zmdi-check"></i>
                                </button>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    </div>